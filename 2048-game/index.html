<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>2048 ‚Äî –ü—Ä–æ—Å—Ç–∞—è –∏–≥—Ä–∞</title>
<style>
:root {
  --bg-primary: #f5e6d3;
  --bg-secondary: #e6d5c1;
  --tile-bg: #e6d5c1;
  --tile-2: #f0e5d3;
  --tile-4: #e6d5c1;
  --tile-8: #d4c4b0;
  --tile-16: #c5b49c;
  --tile-32: #b8a68a;
  --tile-64: #ab9678;
  --tile-128: #9e8666;
  --tile-256: #917654;
  --tile-512: #846642;
  --tile-1024: #775630;
  --tile-2048: #6b4620;
  --text-dark: #4a3c28;
  --text-light: #f5e6d3;
  --accent: #8b7355;
  --shadow: rgba(0,0,0,0.1);
}

/* –¢–µ–º—ã */
.theme-dark {
  --bg-primary: #2d2d2d;
  --bg-secondary: #3a3a3a;
  --tile-bg: #3a3a3a;
  --tile-2: #4a4a4a;
  --tile-4: #5a5a5a;
  --tile-8: #6a6a6a;
  --tile-16: #7a7a7a;
  --tile-32: #8a8a8a;
  --tile-64: #9a9a9a;
  --tile-128: #8b7355;
  --tile-256: #9d8567;
  --tile-512: #af9779;
  --tile-1024: #c1a98b;
  --tile-2048: #d3bb9d;
  --text-dark: #f0e6d3;
  --text-light: #2d2d2d;
  --accent: #d3bb9d;
}

.theme-ocean {
  --bg-primary: #e0f2f1;
  --bg-secondary: #b2ebf2;
  --tile-bg: #b2ebf2;
  --tile-2: #80deea;
  --tile-4: #4dd0e1;
  --tile-8: #26c6da;
  --tile-16: #00bcd4;
  --tile-32: #00acc1;
  --tile-64: #0097a7;
  --tile-128: #00838f;
  --tile-256: #006064;
  --tile-512: #004d40;
  --tile-1024: #00695c;
  --tile-2048: #00796b;
  --text-dark: #004d40;
  --text-light: #e0f2f1;
  --accent: #00838f;
}

.theme-forest {
  --bg-primary: #e8f5e8;
  --bg-secondary: #c8e6c9;
  --tile-bg: #c8e6c9;
  --tile-2: #a5d6a7;
  --tile-4: #81c784;
  --tile-8: #66bb6a;
  --tile-16: #4caf50;
  --tile-32: #43a047;
  --tile-64: #388e3c;
  --tile-128: #2e7d32;
  --tile-256: #1b5e20;
  --tile-512: #2e7d32;
  --tile-1024: #388e3c;
  --tile-2048: #4caf50;
  --text-dark: #1b5e20;
  --text-light: #e8f5e8;
  --accent: #4caf50;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background: var(--bg-primary);
  color: var(--text-dark);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  transition: background 0.3s ease;
}

.container {
  width: 100%;
  max-width: 500px;
  text-align: center;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  gap: 10px;
}

h1 {
  font-size: 52px;
  font-weight: 700;
  color: var(--accent);
}

@media (max-width: 480px) {
  h1 { font-size: 40px; }
}

.score-container {
  display: flex;
  gap: 10px;
}

.score-box {
  background: var(--bg-secondary);
  padding: 10px 16px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
}

.score-value {
  font-size: 20px;
  font-weight: 700;
  display: block;
}

.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  justify-content: center;
  flex-wrap: wrap;
}

button {
  background: var(--accent);
  color: var(--text-light);
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s, opacity 0.2s;
  -webkit-tap-highlight-color: transparent;
}

button:active {
  transform: scale(0.95);
}

select {
  background: var(--bg-secondary);
  color: var(--text-dark);
  border: 2px solid var(--accent);
  padding: 10px;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
}

.board-container {
  background: var(--bg-secondary);
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0 4px 16px var(--shadow);
  position: relative;
  width: 100%;
  max-width: 460px;
  margin: 0 auto;
}

.board {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 10px;
  width: 100%;
  aspect-ratio: 1;
  position: relative;
}

.tile {
  background: var(--tile-bg);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: 700;
  color: var(--text-dark);
  transition: all 0.15s ease-in-out;
  position: absolute;
  width: calc(25% - 7.5px);
  height: calc(25% - 7.5px);
  -webkit-user-select: none;
  user-select: none;
}

.tile.merged {
  animation: pop 0.2s ease;
}

@keyframes pop {
  0% { transform: scale(0.8); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.tile.v2 { background: var(--tile-2); }
.tile.v4 { background: var(--tile-4); }
.tile.v8 { background: var(--tile-8); color: var(--text-light); }
.tile.v16 { background: var(--tile-16); color: var(--text-light); }
.tile.v32 { background: var(--tile-32); color: var(--text-light); }
.tile.v64 { background: var(--tile-64); color: var(--text-light); }
.tile.v128 { background: var(--tile-128); color: var(--text-light); font-size: 28px; }
.tile.v256 { background: var(--tile-256); color: var(--text-light); font-size: 28px; }
.tile.v512 { background: var(--tile-512); color: var(--text-light); font-size: 28px; }
.tile.v1024 { background: var(--tile-1024); color: var(--text-light); font-size: 24px; }
.tile.v2048 { background: var(--tile-2048); color: var(--text-light); font-size: 24px; animation: pulse 1s infinite; }

@keyframes pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(139, 115, 85, 0.7); }
  50% { box-shadow: 0 0 0 10px rgba(139, 115, 85, 0); }
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.overlay.active {
  display: flex;
}

.modal {
  background: var(--bg-primary);
  padding: 40px;
  border-radius: 16px;
  text-align: center;
  max-width: 90%;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { transform: translateY(50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.modal h2 {
  font-size: 36px;
  margin-bottom: 20px;
  color: var(--accent);
}

.modal button {
  margin-top: 20px;
  font-size: 16px;
  padding: 12px 30px;
}

/* Mobile optimizations */
@media (max-width: 480px) {
  .tile {
    font-size: 24px;
  }
  
  .tile.v128, .tile.v256, .tile.v512 {
    font-size: 20px;
  }
  
  .tile.v1024, .tile.v2048 {
    font-size: 16px;
  }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>2048</h1>
    <div class="score-container">
      <div class="score-box">
        –°—á—ë—Ç: <span class="score-value" id="score">0</span>
      </div>
      <div class="score-box">
        –õ—É—á—à–∏–π: <span class="score-value" id="best">0</span>
      </div>
    </div>
  </div>
  
  <div class="controls">
    <button id="new-game">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    <select id="theme-select">
      <option value="beige">–ë–µ–∂–µ–≤—ã–π</option>
      <option value="dark">–¢—ë–º–Ω—ã–π</option>
      <option value="ocean">–û–∫–µ–∞–Ω</option>
      <option value="forest">–õ–µ—Å</option>
    </select>
  </div>
  
  <div class="board-container">
    <div class="board" id="board"></div>
  </div>
</div>

<div class="overlay" id="game-over">
  <div class="modal">
    <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
    <p>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: <span id="final-score">0</span></p>
    <button id="restart">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  </div>
</div>

<div class="overlay" id="victory">
  <div class="modal">
    <h2>üéâ –ü–æ–±–µ–¥–∞! üéâ</h2>
    <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ 2048!</p>
    <p>–°—á—ë—Ç: <span id="victory-score">0</span></p>
    <button id="continue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>
</div>

<script>
const BOARD_SIZE = 4;
const board = document.getElementById('board');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const newGameBtn = document.getElementById('new-game');
const themeSelect = document.getElementById('theme-select');
const gameOverOverlay = document.getElementById('game-over');
const victoryOverlay = document.getElementById('victory');
const finalScoreEl = document.getElementById('final-score');
const victoryScoreEl = document.getElementById('victory-score');

let grid = [];
let score = 0;
let best = parseInt(localStorage.getItem('bestScore') || '0', 10);
let hasWon = false;

bestEl.textContent = best;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Å—Ç–æ–π —Å–µ—Ç–∫–∏
function initGrid() {
  grid = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(0));
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–ª–∏—Ç–∫–∏ (2 –∏–ª–∏ 4)
function addTile() {
  const emptyCells = [];
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      if (grid[r][c] === 0) emptyCells.push([r, c]);
    }
  }
  
  if (emptyCells.length === 0) return false;
  
  const [row, col] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
  grid[row][col] = Math.random() < 0.9 ? 2 : 4;
  return true;
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
function render() {
  board.innerHTML = '';
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      const value = grid[r][c];
      const tile = document.createElement('div');
      tile.className = 'tile';
      
      if (value !== 0) {
        tile.textContent = value;
        tile.classList.add(`v${value}`);
      }
      
      tile.style.left = `${c * 25}%`;
      tile.style.top = `${r * 25}%`;
      board.appendChild(tile);
    }
  }
}

// –°–¥–≤–∏–≥ –∏ —Å–ª–∏—è–Ω–∏–µ –ø–ª–∏—Ç–æ–∫
function move(direction) {
  let moved = false;
  const originalGrid = JSON.stringify(grid);
  
  if (direction === 'left' || direction === 'right') {
    for (let r = 0; r < BOARD_SIZE; r++) {
      let row = grid[r].filter(val => val !== 0);
      if (direction === 'right') row.reverse();
      
      // –°–ª–∏—è–Ω–∏–µ
      for (let i = 0; i < row.length - 1; i++) {
        if (row[i] === row[i + 1]) {
          row[i] *= 2;
          score += row[i];
          row.splice(i + 1, 1);
          moved = true;
        }
      }
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫
      while (row.length < BOARD_SIZE) row.push(0);
      if (direction === 'right') row.reverse();
      
      if (JSON.stringify(grid[r]) !== JSON.stringify(row)) moved = true;
      grid[r] = row;
    }
  } else {
    for (let c = 0; c < BOARD_SIZE; c++) {
      let column = grid.map(row => row[c]).filter(val => val !== 0);
      if (direction === 'down') column.reverse();
      
      // –°–ª–∏—è–Ω–∏–µ
      for (let i = 0; i < column.length - 1; i++) {
        if (column[i] === column[i + 1]) {
          column[i] *= 2;
          score += column[i];
          column.splice(i + 1, 1);
          moved = true;
        }
      }
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫
      while (column.length < BOARD_SIZE) column.push(0);
      if (direction === 'down') column.reverse();
      
      // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      for (let r = 0; r < BOARD_SIZE; r++) {
        if (grid[r][c] !== column[r]) moved = true;
        grid[r][c] = column[r];
      }
    }
  }
  
  if (JSON.stringify(grid) !== originalGrid) moved = true;
  
  return moved;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ö–æ–¥–∞
function canMove() {
  // –ï—Å—Ç—å –ø—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏?
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      if (grid[r][c] === 0) return true;
    }
  }
  
  // –ï—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–∏—è–Ω–∏—è?
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      const current = grid[r][c];
      if (c < BOARD_SIZE - 1 && current === grid[r][c + 1]) return true;
      if (r < BOARD_SIZE - 1 && current === grid[r + 1][c]) return true;
    }
  }
  
  return false;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
function checkWin() {
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      if (grid[r][c] === 2048 && !hasWon) {
        hasWon = true;
        victoryScoreEl.textContent = score;
        victoryOverlay.classList.add('active');
        return true;
      }
    }
  }
  return false;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–¥–∞
function handleMove(direction) {
  if (move(direction)) {
    addTile();
    render();
    updateScore();
    
    if (checkWin()) {
      saveBestScore();
    } else if (!canMove()) {
      finalScoreEl.textContent = score;
      gameOverOverlay.classList.add('active');
      saveBestScore();
    }
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç–∞
function updateScore() {
  scoreEl.textContent = score;
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function saveBestScore() {
  if (score > best) {
    best = score;
    bestEl.textContent = best;
    localStorage.setItem('bestScore', best);
  }
}

// –ù–æ–≤–∞—è –∏–≥—Ä–∞
function newGame() {
  score = 0;
  hasWon = false;
  updateScore();
  gameOverOverlay.classList.remove('active');
  victoryOverlay.classList.remove('active');
  initGrid();
  addTile();
  addTile();
  render();
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowUp') handleMove('up');
  if (e.key === 'ArrowDown') handleMove('down');
  if (e.key === 'ArrowLeft') handleMove('left');
  if (e.key === 'ArrowRight') handleMove('right');
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤
let touchStartX = 0;
let touchStartY = 0;

board.addEventListener('touchstart', (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
}, { passive: true });

board.addEventListener('touchend', (e) => {
  const touchEndX = e.changedTouches[0].clientX;
  const touchEndY = e.changedTouches[0].clientY;
  
  const dx = touchEndX - touchStartX;
  const dy = touchEndY - touchStartY;
  
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 30) handleMove('right');
    else if (dx < -30) handleMove('left');
  } else {
    if (dy > 30) handleMove('down');
    else if (dy < -30) handleMove('up');
  }
}, { passive: true });

// –°–º–µ–Ω–∞ —Ç–µ–º—ã
themeSelect.addEventListener('change', (e) => {
  const theme = e.target.value;
  document.body.className = theme === 'beige' ? '' : `theme-${theme}`;
  localStorage.setItem('theme', theme);
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã
const savedTheme = localStorage.getItem('theme') || 'beige';
if (savedTheme !== 'beige') {
  document.body.className = `theme-${savedTheme}`;
  themeSelect.value = savedTheme;
}

// –ö–Ω–æ–ø–∫–∏
newGameBtn.addEventListener('click', newGame);
document.getElementById('restart').addEventListener('click', newGame);
document.getElementById('continue').addEventListener('click', () => {
  victoryOverlay.classList.remove('active');
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
newGame();
</script>
</body>
</html>

<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2048 — Classic & Chaos (Gradient Edition)</title>
<style>
:root{ 
  --accent:#6fb7e6; 
  --panel:#ffffff; 
  --text:#12343d;
  --board-bg: linear-gradient(180deg,#eef9ff,#f7fbff);
  --cell-bg: linear-gradient(180deg,#f4fbff,#eef7fb);
  --title-gradient: linear-gradient(45deg,#0e3b48 0%,#1a4a5c 25%,#2c5f6b 50%,#4a8b9a 75%,#6fb7e6 100%);
  --title-glow: rgba(111,183,230,0.5);
}

/* Ocean Theme Variables */
body.theme-ocean {
  --accent: #00bcd4;
  --panel: #e0f7fa;
  --text: #006064;
  --board-bg: linear-gradient(180deg,#b2ebf2,#80deea);
  --cell-bg: linear-gradient(180deg,#e0f2f1,#b2dfdb);
  --title-gradient: linear-gradient(45deg,#006064 0%,#00838f 25%,#0097a7 50%,#00acc1 75%,#00bcd4 100%);
  --title-glow: rgba(0,188,212,0.7);
}

/* Forest Theme Variables */
body.theme-forest {
  --accent: #4caf50;
  --panel: #e8f5e8;
  --text: #1b5e20;
  --board-bg: linear-gradient(180deg,#c8e6c9,#a5d6a7);
  --cell-bg: linear-gradient(180deg,#e8f5e8,#c8e6c9);
  --title-gradient: linear-gradient(45deg,#1b5e20 0%,#2e7d32 25%,#388e3c 50%,#43a047 75%,#4caf50 100%);
  --title-glow: rgba(76,175,80,0.7);
}

/* Space Theme Variables */
body.theme-space {
  --accent: #9c27b0;
  --panel: #1a1a2e;
  --text: #e1bee7;
  --board-bg: linear-gradient(180deg,#2d1b69,#1a1a2e);
  --cell-bg: linear-gradient(180deg,#3f2a7a,#2d1b69);
  --title-gradient: linear-gradient(45deg,#4a148c 0%,#6a1b9a 25%,#7b1fa2 50%,#8e24aa 75%,#9c27b0 100%);
  --title-glow: rgba(156,39,176,0.8);
}

*{box-sizing:border-box;margin:0;padding:0} html,body{height:100%}
body{
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  background: linear-gradient(135deg, #dceffb 0%, #f7d7ff 60%);
  display:flex;align-items:flex-start;justify-content:center;padding:20px;color:var(--text);
  transition: all 0.5s ease;
}

/* Ocean Theme Body */
body.theme-ocean {
  background: linear-gradient(135deg, #b3e5fc 0%, #81d4fa 50%, #4fc3f7 100%);
}

/* Forest Theme Body */
body.theme-forest {
  background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 50%, #81c784 100%);
}

/* Space Theme Body */
body.theme-space {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
}

.app{ 
  width:min(560px,96vw); 
  background:var(--panel); 
  border-radius:16px; 
  padding:20px; 
  box-shadow:0 18px 50px rgba(17,24,39,0.12); 
  position:relative; 
  border:3px solid #2d3748; 
  box-shadow:0 18px 50px rgba(17,24,39,0.12), 0 0 20px rgba(45,55,72,0.4); 
  animation:borderGlow 3s ease-in-out infinite;
  transition: all 0.5s ease;
}

/* Ocean Theme App */
body.theme-ocean .app {
  background: rgba(224,247,250,0.95);
  border-color: #00838f;
  box-shadow: 0 18px 50px rgba(0,131,143,0.2), 0 0 30px rgba(0,188,212,0.4);
}

/* Space Theme App */
body.theme-space .app {
  background: rgba(26,26,46,0.95);
  border-color: #9c27b0;
  color: #e1bee7;
}

.header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
.title{
  font-size:42px;
  font-weight:900;
  background: var(--title-gradient);
  background-size:300% 300%;
  animation:gradientShift 4s ease infinite, titleFloat 6s ease-in-out infinite;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  text-shadow:
    0 6px 0 rgba(14,59,72,0.8),
    0 12px 0 rgba(14,59,72,0.6),
    0 18px 0 rgba(14,59,72,0.4),
    0 24px 0 rgba(14,59,72,0.2),
    0 30px 15px rgba(0,0,0,0.3),
    0 0 30px var(--title-glow);
  transform:perspective(400px) rotateX(12deg) rotateY(-2deg);
  letter-spacing:4px;
  margin:0;
  position:relative;
  filter:drop-shadow(0 8px 16px rgba(14,59,72,0.3));
  transition: all 0.5s ease;
}

/* Ocean Theme Title */
body.theme-ocean .title {
  text-shadow:
    0 6px 0 rgba(0,96,100,0.8),
    0 12px 0 rgba(0,96,100,0.6),
    0 18px 0 rgba(0,96,100,0.4),
    0 24px 0 rgba(0,96,100,0.2),
    0 30px 15px rgba(0,0,0,0.3),
    0 0 30px var(--title-glow);
  filter:drop-shadow(0 8px 16px rgba(0,96,100,0.3));
}

/* Space Theme Title */
body.theme-space .title {
  text-shadow:
    0 6px 0 rgba(74,20,140,0.8),
    0 12px 0 rgba(74,20,140,0.6),
    0 18px 0 rgba(74,20,140,0.4),
    0 24px 0 rgba(74,20,140,0.2),
    0 30px 15px rgba(0,0,0,0.5),
    0 0 30px var(--title-glow);
  filter:drop-shadow(0 8px 16px rgba(74,20,140,0.3));
}

.title::before{
  content:"2048";
  position:absolute;
  top:0;
  left:0;
  background:linear-gradient(45deg,#FFD700,#FFA500,#FF6B6B);
  background-size:200% 200%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  animation:titleGlow 3s ease-in-out infinite;
  opacity:0.7;
  z-index:-1;
  filter:blur(2px);
}

/* Ocean Theme Title Glow */
body.theme-ocean .title::before {
  background:linear-gradient(45deg,#00bcd4,#4dd0e1,#26c6da);
}

/* Space Theme Title Glow */
body.theme-space .title::before {
  background:linear-gradient(45deg,#9c27b0,#ba68c8,#ce93d8);
}

@keyframes titleFloat{
  0%,100%{transform:perspective(400px) rotateX(12deg) rotateY(-2deg) translateY(0px)}
  50%{transform:perspective(400px) rotateX(12deg) rotateY(-2deg) translateY(-3px)}
}
@keyframes titleGlow{
  0%,100%{opacity:0.3;transform:scale(1.02)}
  50%{opacity:0.8;transform:scale(1.05)}
}
.subtitle{font-size:13px;color:#45636c;margin-top:8px;font-weight:600;transition: color 0.5s ease;}

/* Ocean Theme Subtitle */
body.theme-ocean .subtitle {
  color: #00695c;
}

/* Space Theme Subtitle */
body.theme-space .subtitle {
  color: #ce93d8;
}

.stats{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.score-pill{
  background:linear-gradient(180deg,var(--accent),#58aee8);
  color:#fff;
  padding:8px 12px;
  border-radius:10px;
  font-weight:700;
  font-size:13px;
  transition: all 0.5s ease;
}

/* Ocean Theme Score Pills */
body.theme-ocean .score-pill {
  background:linear-gradient(180deg,var(--accent),#26c6da);
}

/* Space Theme Score Pills */
body.theme-space .score-pill {
  background:linear-gradient(180deg,var(--accent),#ba68c8);
}

.controls{display:flex;gap:8px;margin:14px 0;flex-wrap:wrap}
.mode-btn, .btn{
  background:#fff;
  border:1px solid rgba(0,0,0,0.08);
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  transition: all 0.5s ease;
}

/* Ocean Theme Buttons */
body.theme-ocean .mode-btn, 
body.theme-ocean .btn {
  background: rgba(224,247,250,0.8);
  color: var(--text);
  border-color: rgba(0,131,143,0.2);
}

/* Space Theme Buttons */
body.theme-space .mode-btn, 
body.theme-space .btn {
  background: rgba(26,26,46,0.8);
  color: #e1bee7;
  border-color: rgba(156,39,176,0.3);
}

.mode-btn.active{
  background:var(--accent);
  color:#fff;
  border:none;
  box-shadow:0 8px 18px rgba(0,0,0,0.08);
}
.btn.primary{
  background:var(--accent);
  color:#fff;
  border:none;
}

.board-shell{
  background: var(--board-bg);
  padding:14px;
  border-radius:14px;
  box-shadow: inset 0 6px 14px rgba(255,255,255,0.6), 0 12px 30px rgba(17,24,39,0.06); 
  margin-top:6px;
  position:relative;
  transition: all 0.5s ease;
}

/* Ocean Theme Board Shell */
body.theme-ocean .board-shell {
  box-shadow: inset 0 6px 14px rgba(0,188,212,0.3), 0 12px 30px rgba(0,131,143,0.15);
}

/* Space Theme Board Shell */
body.theme-space .board-shell {
  box-shadow: inset 0 6px 14px rgba(156,39,176,0.3), 0 12px 30px rgba(74,20,140,0.2);
}

.board{width:460px;height:460px;display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);gap:16px;padding:14px;border-radius:12px;position:relative;overflow:visible}
.cell{
  background: var(--cell-bg);
  border-radius:12px;
  box-shadow: inset 0 4px 10px rgba(255,255,255,0.6), 0 6px 12px rgba(0,0,0,0.03);
  transition: all 0.5s ease;
}

/* Ocean Theme Cells */
body.theme-ocean .cell {
  box-shadow: inset 0 4px 10px rgba(0,188,212,0.2), 0 6px 12px rgba(0,131,143,0.1);
}

/* Space Theme Cells */
body.theme-space .cell {
  box-shadow: inset 0 4px 10px rgba(156,39,176,0.2), 0 6px 12px rgba(74,20,140,0.15);
}

.tile{ 
  position:absolute;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
  font-weight:900;
  color:#12343d;
  box-shadow: 0 12px 30px rgba(15,23,42,0.12), inset 0 1px 0 rgba(255,255,255,0.4); 
  transition: transform 500ms cubic-bezier(.22,.9,.12,1), width 200ms, height 200ms, background 0.5s ease; 
  user-select:none; 
  will-change:transform; 
  font-size:20px; 
}

/* Ocean Theme Tiles */
body.theme-ocean .tile.v2{background:linear-gradient(180deg,#e0f2f1,#b2dfdb);color:#004d40}
body.theme-ocean .tile.v4{background:linear-gradient(180deg,#b2dfdb,#80cbc4);color:#004d40}
body.theme-ocean .tile.v8{background:linear-gradient(180deg,#80cbc4,#4db6ac);color:#fff}
body.theme-ocean .tile.v16{background:linear-gradient(180deg,#4db6ac,#26a69a);color:#fff}
body.theme-ocean .tile.v32{background:linear-gradient(180deg,#26a69a,#009688);color:#fff}
body.theme-ocean .tile.v64{background:linear-gradient(180deg,#009688,#00796b);color:#fff}
body.theme-ocean .tile.v128{background:linear-gradient(180deg,#00796b,#00695c);color:#fff;font-size:18px}
body.theme-ocean .tile.v256{background:linear-gradient(180deg,#00695c,#004d40);color:#fff;font-size:18px}
body.theme-ocean .tile.v512{background:linear-gradient(180deg,#004d40,#00251a);color:#fff;font-size:18px}
body.theme-ocean .tile.v1024{background:linear-gradient(180deg,#006064,#004d40);color:#fff;font-size:18px}
body.theme-ocean .tile.v2048{background:linear-gradient(180deg,#00bcd4,#0097a7);color:#fff;font-size:18px;box-shadow:0 12px 34px rgba(0,188,212,0.4)}

/* Forest Theme Tiles */
body.theme-forest .tile.v2{background:linear-gradient(180deg,#e8f5e8,#c8e6c9);color:#1b5e20}
body.theme-forest .tile.v4{background:linear-gradient(180deg,#c8e6c9,#a5d6a7);color:#1b5e20}
body.theme-forest .tile.v8{background:linear-gradient(180deg,#a5d6a7,#81c784);color:#fff}
body.theme-forest .tile.v16{background:linear-gradient(180deg,#81c784,#66bb6a);color:#fff}
body.theme-forest .tile.v32{background:linear-gradient(180deg,#66bb6a,#4caf50);color:#fff}
body.theme-forest .tile.v64{background:linear-gradient(180deg,#4caf50,#43a047);color:#fff}
body.theme-forest .tile.v128{background:linear-gradient(180deg,#43a047,#388e3c);color:#fff;font-size:18px}
body.theme-forest .tile.v256{background:linear-gradient(180deg,#388e3c,#2e7d32);color:#fff;font-size:18px}
body.theme-forest .tile.v512{background:linear-gradient(180deg,#2e7d32,#27691c);color:#fff;font-size:18px}
body.theme-forest .tile.v1024{background:linear-gradient(180deg,#27691c,#1b5e20);color:#fff;font-size:18px}
body.theme-forest .tile.v2048{background:linear-gradient(180deg,#4caf50,#2e7d32);color:#fff;font-size:18px;box-shadow:0 12px 34px rgba(76,175,80,0.4)}

/* Space Theme Tiles */
body.theme-space .tile.v2{background:linear-gradient(180deg,#3f2a7a,#2d1b69);color:#e1bee7}
body.theme-space .tile.v4{background:linear-gradient(180deg,#512da8,#3f2a7a);color:#e1bee7}
body.theme-space .tile.v8{background:linear-gradient(180deg,#673ab7,#512da8);color:#fff}
body.theme-space .tile.v16{background:linear-gradient(180deg,#7b1fa2,#673ab7);color:#fff}
body.theme-space .tile.v32{background:linear-gradient(180deg,#8e24aa,#7b1fa2);color:#fff}
body.theme-space .tile.v64{background:linear-gradient(180deg,#9c27b0,#8e24aa);color:#fff}
body.theme-space .tile.v128{background:linear-gradient(180deg,#ab47bc,#9c27b0);color:#fff;font-size:18px}
body.theme-space .tile.v256{background:linear-gradient(180deg,#ba68c8,#ab47bc);color:#fff;font-size:18px}
body.theme-space .tile.v512{background:linear-gradient(180deg,#ce93d8,#ba68c8);color:#fff;font-size:18px}
body.theme-space .tile.v1024{background:linear-gradient(180deg,#e1bee7,#ce93d8);color:#4a148c;font-size:18px}
body.theme-space .tile.v2048{background:linear-gradient(180deg,#9c27b0,#6a1b9a);color:#fff;font-size:18px;box-shadow:0 12px 34px rgba(156,39,176,0.4)}

/* Default Theme Tiles */
.tile.v2{background:linear-gradient(180deg,#e8f7fb,#dff3fb);color:#0e3b48}
.tile.v4{background:linear-gradient(180deg,#dff3f9,#d0ecf9);color:#0e3b48}
.tile.v8{background:linear-gradient(180deg,#ffd6ad,#ffbf7a);color:#fff}
.tile.v16{background:linear-gradient(180deg,#ffb07b,#ff8d49);color:#fff}
.tile.v32{background:linear-gradient(180deg,#ffa07b,#ff7a49);color:#fff}
.tile.v64{background:linear-gradient(180deg,#e8755d,#d94a2b);color:#fff}
.tile.v128{background:#b07ad9;color:#fff;font-size:18px}
.tile.v256{background:#8a6bd1;color:#fff;font-size:18px}
.tile.v512{background:#5b4a9e;color:#fff;font-size:18px}
.tile.v1024{background:#3e2f7b;color:#fff;font-size:18px}
.tile.v2048{background:#2b1f59;color:#fff;font-size:18px;box-shadow:0 12px 34px rgba(0,0,0,0.25)}

@keyframes vibrate {0%{transform:translate(var(--tile-x),var(--tile-y)) rotate(0deg)}25%{transform:translate(calc(var(--tile-x) + 2px),var(--tile-y)) rotate(1deg)}50%{transform:translate(var(--tile-x),calc(var(--tile-y) + 2px)) rotate(-1deg)}75%{transform:translate(calc(var(--tile-x) - 2px),var(--tile-y)) rotate(1deg)}100%{transform:translate(var(--tile-x),var(--tile-y)) rotate(0deg)}}
.tile.v1024{animation:vibrate .25s infinite linear}
@keyframes magnet {0%,100%{transform:translate(var(--tile-x),var(--tile-y)) scale(1)}50%{transform:translate(var(--tile-x),var(--tile-y)) scale(1.12)}}
.tile.v2048{animation:magnet 1s infinite ease-in-out}
@keyframes legendaryPulse{0%{transform:translate(var(--tile-x),var(--tile-y)) scale(1);filter:drop-shadow(0 0 6px rgba(255,150,0,0.2))}50%{transform:translate(var(--tile-x),var(--tile-y)) scale(1.14);filter:drop-shadow(0 0 20px rgba(126,255,199,0.45))}100%{transform:translate(var(--tile-x),var(--tile-y)) scale(1);filter:drop-shadow(0 0 6px rgba(255,150,0,0.2))}}
.tile.legendary{background:linear-gradient(135deg,#ff5f6d 0%,#ffc371 50%,#7effc7 100%);color:#111;box-shadow:0 12px 40px rgba(255,150,0,0.35),0 0 40px rgba(126,255,199,0.12) inset;border:2px solid rgba(255,215,0,0.6);animation:legendaryPulse 1.6s ease-in-out infinite;font-weight:900}
.tile.new{ animation: pop 420ms cubic-bezier(.22,.9,.12,1); transform-origin:center; }
@keyframes pop{0%{transform:translate(var(--tile-x),var(--tile-y)) scale(.2) rotate(-6deg);opacity:0}60%{transform:translate(var(--tile-x),var(--tile-y)) scale(1.08) rotate(2deg);opacity:1}100%{transform:translate(var(--tile-x),var(--tile-y)) scale(1) rotate(0deg);opacity:1}}
@keyframes slideInUp{0%{transform:translateY(60px);opacity:0}100%{transform:translateY(0);opacity:1}}
@keyframes glowPulse{0%,100%{box-shadow:0 8px 32px rgba(0,0,0,0.3), 0 0 20px currentColor}50%{box-shadow:0 8px 32px rgba(0,0,0,0.3), 0 0 30px currentColor}}
@keyframes bounceIn{0%{transform:scale(0.3);opacity:0}50%{transform:scale(1.05)}70%{transform:scale(0.9)}100%{transform:scale(1);opacity:1}}
@keyframes float{0%,100%{transform:translateY(0px)}50%{transform:translateY(-10px)}}
@keyframes wiggle{0%,100%{transform:rotate(-3deg)}50%{transform:rotate(3deg)}}
@keyframes borderGlow{0%,100%{box-shadow:0 18px 50px rgba(17,24,39,0.12), 0 0 20px rgba(45,55,72,0.4)}50%{box-shadow:0 18px 50px rgba(17,24,39,0.12), 0 0 30px rgba(45,55,72,0.6)}}
@keyframes explosion{0%{transform:scale(1) rotate(0deg);filter:brightness(1)}50%{transform:scale(1.5) rotate(180deg);filter:brightness(2) saturate(2)}100%{transform:scale(3) rotate(360deg);filter:brightness(3) saturate(3);opacity:0}}
@keyframes victoryPulse{0%{transform:scale(1);filter:drop-shadow(0 0 20px rgba(255,215,0,0.8))}50%{transform:scale(1.1);filter:drop-shadow(0 0 40px rgba(255,215,0,1))}100%{transform:scale(1);filter:drop-shadow(0 0 20px rgba(255,215,0,0.8))}}
@keyframes fireworks{0%{transform:translateY(100vh) scale(0);opacity:0}50%{opacity:1}100%{transform:translateY(-100vh) scale(1.5);opacity:0}}
@keyframes starBurst{0%{transform:scale(0) rotate(0deg);opacity:1}50%{transform:scale(1.2) rotate(180deg);opacity:0.8}100%{transform:scale(2) rotate(360deg);opacity:0}}
@keyframes victoryShake{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-10px) rotate(-1deg)}20%,40%,60%,80%{transform:translateX(10px) rotate(1deg)}}
.victory-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:2000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.5s ease}
.victory-content{background:linear-gradient(145deg,#1a1a2e 0%,#16213e 50%,#0f1419 100%);border:4px solid #FFD700;border-radius:24px;padding:40px;max-width:500px;width:90%;text-align:center;color:#fff;box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 40px rgba(255,215,0,0.5);animation:bounceIn 0.8s ease, victoryPulse 2s ease-in-out infinite 1s}
.victory-title{font-size:48px;font-weight:900;background:linear-gradient(45deg,#FFD700,#FFA500,#FF6B6B,#4ECDC4);background-size:400% 400%;animation:gradientShift 2s ease infinite;text-shadow:0 6px 0 #FFD700,0 12px 0 rgba(255,215,0,0.8),0 18px 0 rgba(255,215,0,0.6),0 24px 0 rgba(255,215,0,0.4),0 30px 0 rgba(255,215,0,0.2),0 36px 20px rgba(0,0,0,0.3);transform:perspective(400px) rotateX(15deg);color:#fff;letter-spacing:4px;margin:20px 0;animation:gradientShift 2s ease infinite, victoryShake 0.5s ease-in-out 2s}
.explosion-particle{position:absolute;width:8px;height:8px;background:radial-gradient(circle,#FFD700,#FFA500);border-radius:50%;pointer-events:none;animation:starBurst 1s ease-out forwards}
.firework{position:absolute;width:4px;height:4px;background:radial-gradient(circle,#FFD700,#FF6B6B,#4ECDC4);border-radius:50%;pointer-events:none;animation:fireworks 3s ease-out forwards}
.title-3d{font-size:56px;font-weight:900;background:linear-gradient(45deg,#FFD700,#FFA500,#FF6B6B,#4ECDC4);background-size:400% 400%;animation:gradientShift 3s ease infinite;text-shadow:0 6px 0 #FFD700,0 12px 0 rgba(255,215,0,0.8),0 18px 0 rgba(255,215,0,0.6),0 24px 0 rgba(255,215,0,0.4),0 30px 0 rgba(255,215,0,0.2),0 36px 15px rgba(0,0,0,0.3);transform:perspective(500px) rotateX(15deg);color:#fff;letter-spacing:3px;margin:15px 0}
@keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.tutorial-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:1000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.5s ease;padding:20px;box-sizing:border-box}
@keyframes fadeIn{0%{opacity:0}100%{opacity:1}}
.tutorial-content{background:linear-gradient(145deg,#1a1a2e 0%,#16213e 50%,#0f1419 100%);border:3px solid #FFD700;border-radius:20px;padding:25px;max-width:480px;width:90%;text-align:center;color:#fff;box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 30px rgba(255,215,0,0.3);animation:bounceIn 0.8s ease;margin:auto;position:relative;max-height:90vh;overflow-y:auto}
.tutorial-character{font-size:80px;margin-bottom:15px;animation:float 2s ease-in-out infinite;filter:drop-shadow(0 0 20px rgba(255,215,0,0.5));transition:transform 0.3s ease}
.tutorial-character:hover{animation:wiggle 0.5s ease-in-out infinite}
.tutorial-step{background:rgba(255,255,255,0.1);padding:15px;border-radius:12px;margin:15px 0;border-left:4px solid #FFD700}
.tutorial-btn{background:linear-gradient(135deg,#FFD700,#FFA500);color:#000;border:none;padding:12px 24px;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;margin:8px;transition:all 0.3s ease;box-shadow:0 6px 16px rgba(255,215,0,0.3)}
.tutorial-btn:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(255,215,0,0.5)}
.tutorial-btn.secondary{background:linear-gradient(135deg,#666,#555);color:#fff}
.tutorial-btn.secondary:hover{background:linear-gradient(135deg,#777,#666)}
.modal, .results-panel, #shop-panel{background:var(--panel);padding:14px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.14);position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:120;display:none;max-width:94vw}
.modal.active, .results-panel.active, #shop-panel.active{display:block}
#results-list{max-height:320px;overflow-y:auto;padding-left:12px;-webkit-overflow-scrolling:touch;scroll-behavior:smooth;}
.results-list-item{display:flex;align-items:center;gap:12px;padding:8px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfbf8);margin-bottom:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.results-list-item .rank{width:44px;text-align:center;font-weight:900}
.results-list-item.gold-card{background:linear-gradient(145deg,#fff8dc,#ffd700,#ffae00);border:3px solid #ffd700;color:#3b2b00;font-weight:900;box-shadow:0 0 20px rgba(255,215,0,0.95),0 0 40px rgba(255,165,0,0.75);position:relative;padding-left:40px}
.results-list-item.gold-card::before{content:"👑";position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:22px}
.results-list-item.silver-card{background:linear-gradient(145deg,#f8f9fa,#c0c0c0,#a8a8a8);border:3px solid #c0c0c0;color:#2c3e50;font-weight:900;box-shadow:0 0 20px rgba(192,192,192,0.8),0 0 40px rgba(168,168,168,0.6);position:relative;padding-left:40px}
.results-list-item.silver-card::before{content:"🥈";position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:22px}
.results-list-item.bronze-card{background:linear-gradient(145deg,#fdf5e6,#cd7f32,#b8860b);border:3px solid #cd7f32;color:#8b4513;font-weight:900;box-shadow:0 0 20px rgba(205,127,50,0.8),0 0 40px rgba(184,134,11,0.6);position:relative;padding-left:40px}
.results-list-item.bronze-card::before{content:"🥉";position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:22px}
#bottom-nav{position:fixed;left:10px;right:10px;bottom:12px;height:76px;background:#fff;border-radius:14px;display:flex;gap:8px;align-items:center;justify-content:space-around;box-shadow:0 18px 40px rgba(2,6,23,0.12);z-index:200}
#bottom-nav .nav-btn{flex:1;border:none;background:none;padding:10px;border-radius:10px;font-weight:700;color:#666;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer}
#bottom-nav .nav-btn span{font-size:22px}
#bottom-nav .nav-btn.active{color:#1e90ff;text-shadow:0 0 10px rgba(30,144,255,0.4)}
#shop-panel{left:50%;transform:translate(-50%,0);bottom:92px;top:auto;position:fixed;width:min(400px,90vw);max-height:70vh;overflow:hidden;display:none;background:linear-gradient(145deg,#1a1a2e 0%,#16213e 50%,#0f1419 100%);color:#fff;border:2px solid #4a5568;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 30px rgba(59,130,246,0.3)}
#shop-items{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:12px;overflow-y:auto;max-height:50vh}
#chaos-tips{
  position:absolute;
  top:10px;
  right:10px;
  width:200px;
  background:#fff;
  padding:10px;
  border-radius:10px;
  box-shadow:0 8px 24px rgba(0,0,0,0.15);
  display:none;
  z-index:100;
  font-size:12px;
  border:2px solid #2d3748;
  transform:translateY(0);
  transition: all 0.5s ease;
}

/* Ocean Theme Chaos Tips */
body.theme-ocean #chaos-tips {
  background: rgba(224,247,250,0.95);
  border-color: #00838f;
  color: #004d40;
}

/* Space Theme Chaos Tips */
body.theme-space #chaos-tips {
  background: rgba(26,26,46,0.95);
  border-color: #9c27b0;
  color: #e1bee7;
}

@media(max-width:520px){ 
  .board{width:92vw;height:92vw;gap:10px;padding:12px} 
  .app{padding:12px} 
  #bottom-nav{left:8px;right:8px;height:72px} 
  .tutorial-content{padding:20px;max-width:95vw;max-height:85vh} 
  .title-3d{font-size:40px;letter-spacing:2px;margin:10px 0} 
  .tutorial-character{font-size:60px;margin-bottom:10px} 
  .tutorial-btn{padding:10px 16px;font-size:14px;margin:6px} 
  .tutorial-step{padding:12px;margin:12px 0} 
  .title{
    font-size:32px;
    letter-spacing:3px;
    text-shadow:
      0 4px 0 rgba(14,59,72,0.8),
      0 8px 0 rgba(14,59,72,0.6),
      0 12px 0 rgba(14,59,72,0.4),
      0 16px 0 rgba(14,59,72,0.2),
      0 20px 12px rgba(0,0,0,0.3),
      0 0 20px rgba(111,183,230,0.4);
    transform:perspective(300px) rotateX(10deg) rotateY(-1deg);
  } 
  #shop-panel{width:95vw;max-height:80vh} 
  #shop-items{grid-template-columns:1fr;gap:8px;max-height:60vh} 
  #chaos-tips{
    position:relative;
    width:100%;
    margin-top:10px;
    right:auto;
    top:auto;
    transform:none;
  }
  #results-list{
    max-height:250px;
    overflow-y:scroll;
    -webkit-overflow-scrolling:touch;
    overscroll-behavior:contain;
  }
}
.hidden{display:none}
</style>
</head>
<body>
<div id="tutorial-modal" class="tutorial-modal" style="z-index:300">
  <div class="tutorial-content">
    <div class="tutorial-character">🧙‍♂️</div>
    <div class="title-3d">2048</div>
    <h2 style="margin:15px 0;color:#FFD700;font-size:22px;">Добро пожаловать в Classic & Chaos!</h2>
    
    <div class="tutorial-step">
      <h3 style="color:#4ECDC4;margin-bottom:8px;font-size:16px;">🎯 Цель игры</h3>
      <p style="font-size:14px;margin:0;">Объединяйте одинаковые числа, чтобы получить 2048!</p>
    </div>
    
    <div class="tutorial-step">
      <h3 style="color:#FF6B6B;margin-bottom:8px;font-size:16px;">🎮 Управление</h3>
      <p style="font-size:14px;margin:0;">Стрелки ←↑→↓ или свайпы</p>
    </div>
    
    <div class="tutorial-step">
      <h3 style="color:#4ECDC4;margin-bottom:8px;font-size:16px;">⚡ Режимы</h3>
      <p style="font-size:14px;margin:0;"><strong>Классика:</strong> Обычная игра<br>
      <strong>Хаос:</strong> Магические плитки!</p>
    </div>
    
    <div style="margin-top:20px;">
      <button id="tutorial-start" class="tutorial-btn">🚀 Начать игру!</button>
      <button id="tutorial-shop" class="tutorial-btn" style="background:linear-gradient(135deg,#4ECDC4,#44A08D);color:#fff;">🛍️ Магазин</button>
    </div>
    
    <div style="margin-top:15px;">
      <button id="tutorial-skip" class="tutorial-btn secondary">⏭️ Пропустить</button>
    </div>
    
    <div style="margin-top:15px;font-size:12px;color:#aaa;">
      💡 В режиме Хаос есть подсказки для специальных плиток
    </div>
  </div>
</div>
<div class="app" id="game-app" role="application" aria-label="2048 game">
  <div class="header">
    <div>
      <div class="title">2048</div>
      <div class="subtitle">Classic & Chaos — Gradient Edition</div>
    </div>
    <div class="stats">
      <div class="score-pill">Счёт: <span id="score">0</span></div>
      <div class="score-pill">Лучший: <span id="best-score">0</span></div>
      <div class="score-pill">Ходы: <span id="moves">0</span></div>
      <div class="score-pill">Время: <span id="time">00:00</span></div>
    </div>
  </div>
  <div class="controls" role="toolbar">
    <button id="mode-classic" class="mode-btn active">Классика</button>
    <button id="mode-chaos" class="mode-btn">Хаос</button>
    <button id="new-game-btn" class="btn primary">Новая игра</button>
  </div>
  <div class="board-wrap">
    <div class="board-shell">
      <div id="game-board" class="board" aria-label="Игровое поле" tabindex="0"></div>
      <div id="chaos-tips" aria-hidden="true">
        <h4 style="margin:0 0 8px 0;color:#2d3748;font-size:14px;font-weight:700;">🔮 Подсказки Хаоса</h4>
        <ul style="margin:0;padding-left:16px;font-size:11px;line-height:1.4;">
          <li>💣 <b>Бомба</b> — уничтожает соседние плитки</li>
          <li>× <b>Множитель</b> — увеличивает соседний куб</li>
          <li>❄ <b>Заморозка</b> — блокирует кубы на 3 хода</li>
          <li>★ <b>Джокер</b> — объединяется с любым кубом</li>
          <li>🔀 <b>Шафл</b> — перемешивает кубы</li>
        </ul>
      </div>
    </div>
    <div style="margin-top:10px;font-size:13px;color:#45636c">Используй стрелки или свайпы. 
  </div>
</div>
<div id="results-panel" class="results-panel" aria-hidden="true">
  <h3>История игр</h3>
  <ul id="results-list"></ul>
  <div style="text-align:right;margin-top:10px">
    <button id="close-results" class="btn">✖ Закрыть</button>
  </div>
</div>
<div id="shop-panel" aria-hidden="true">
  <h3 style="color:#fff;text-align:center;margin:0 0 16px 0;font-size:20px;font-weight:700;text-shadow:0 2px 8px rgba(0,0,0,0.5);background:linear-gradient(135deg,#FFD700,#FFA500);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">🛍️ МАГАЗИН ФОНОВ</h3>
  <div id="shop-items"></div>
  <div style="display:flex;gap:8px;align-items:center;margin-top:16px;justify-content:center">
    <div style="color:#fff;font-size:14px">💰 Баланс: <strong id="fake-balance" style="color:#FFD700">0</strong> ₽</div>
    <button onclick="window.milk2048.addMoney(100)" style="background:linear-gradient(135deg,#4CAF50,#45a049);color:#fff;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;font-size:12px;margin-left:10px;">+100₽</button>
  </div>
</div>
<div id="victory-modal" class="victory-modal" style="display:none;z-index:2000">
  <div class="victory-content">
    <div style="font-size:80px;margin-bottom:20px;animation:float 2s ease-in-out infinite">🎉</div>
    <div class="victory-title">ПОБЕДА!</div>
    <h2 style="margin:20px 0;color:#FFD700;font-size:24px;">Вы достигли 2048!</h2>
    <div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:16px;margin:20px 0;border:2px solid #FFD700">
      <div style="font-size:32px;color:#FFD700;font-weight:700;margin-bottom:10px">🏆 Счёт: <span id="victory-score">0</span></div>
      <div style="font-size:18px;color:#4ECDC4;margin-bottom:5px">⭐ Ходы: <span id="victory-moves">0</span></div>
      <div style="font-size:18px;color:#4ECDC4">⏱️ Время: <span id="victory-time">00:00</span></div>
    </div>
    <div style="margin-top:30px;">
      <button id="victory-continue" class="tutorial-btn" style="background:linear-gradient(135deg,#4CAF50,#45a049);color:#fff;margin:8px">🚀 Продолжить</button>
      <button id="victory-restart" class="tutorial-btn" style="background:linear-gradient(135deg,#FF9800,#e68900);color:#fff;margin:8px">🔄 Заново</button>
    </div>
    <div style="margin-top:20px;font-size:14px;color:#aaa;">
      🎊 Вы настоящий мастер 2048! 🎊
    </div>
  </div>
</div>

<div id="modal-win" class="modal" aria-hidden="true" style="display:none;">
  <h3>🎉 Поздравляем — 2048!</h3>
  <p>Счёт: <span id="win-score">0</span></p>
  <div style="text-align:center;margin-top:10px">
    <button id="continue-btn" class="btn primary">Продолжить</button>
    <button id="close-win" class="btn">Закрыть</button>
  </div>
</div>
<div id="modal-over" class="modal" aria-hidden="true">
  <h3>Игра окончена</h3>
  <p>Счёт: <span id="final-score">0</span></p>
  <div style="text-align:center;margin-top:10px">
    <button id="restart-btn" class="btn primary">Заново</button>
    <button id="close-over" class="btn">Закрыть</button>
  </div>
</div>
<div id="bottom-nav" aria-hidden="false">
  <button class="nav-btn active" data-target="game-app"><span>🎮</span><div>Игра</div></button>
  <button class="nav-btn" data-target="shop-panel"><span>🛍️</span><div>Магазин</div></button>
  <button class="nav-btn" data-target="results-panel"><span>📊</span><div>Результаты</div></button>
</div>
<script>
const MERGE_SOUND_URL = 'https://actions.google.com/sounds/v1/water/bubble.ogg';
const SWISH_SOUND_URL = 'https://actions.google.com/sounds/v1/office/paper_tear.ogg';
(function(){
  const SIZE = 4;
  const boardEl = document.getElementById('game-board');
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best-score');
  const movesEl = document.getElementById('moves');
  const timeEl = document.getElementById('time');
  const resultsList = document.getElementById('results-list');
  const shopItems = document.getElementById('shop-items');
  const chaosTips = document.getElementById('chaos-tips');
  const uploadBg = document.getElementById('upload-bg');
  const welcomeModal = document.getElementById('welcome-modal');
  const mergeSound = new Audio(MERGE_SOUND_URL);
  mergeSound.volume = 0.6;
  const swishSound = new Audio(SWISH_SOUND_URL);
  swishSound.volume = 0.4;
  let grid = []; let tiles = {}; let nextId = 1; let score = 0; let best = parseInt(localStorage.getItem('milk2048_best')||'0',10)||0; let moves = 0; let seconds = 0; let timer = null; let mode = 'classic'; let purchasedBackgrounds = JSON.parse(localStorage.getItem('milk2048_purchased')||'["default"]'); let fakeBalance = parseInt(localStorage.getItem('milk2048_balance')||'0',10); let currentTheme = localStorage.getItem('milk2048_theme') || 'default';
  
  // Apply saved theme on load
  function applyTheme(theme) {
    document.body.className = theme === 'default' ? '' : `theme-${theme}`;
    currentTheme = theme;
    localStorage.setItem('milk2048_theme', theme);
  }
  
  function emptyGrid(){ return Array.from({length:SIZE}, ()=> Array(SIZE).fill(0)); }
  function resetState(){ grid = emptyGrid(); tiles = {}; nextId = 1; score = 0; moves = 0; seconds = 0; }
  function startTimer(){ if(timer) clearInterval(timer); timer=setInterval(()=>{ seconds++; timeEl.textContent = formatTime(seconds); },1000); }
  function stopTimer(){ if(timer) clearInterval(timer); timer=null; }
  function formatTime(s){ return String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0'); }
  function saveState(){ try{ localStorage.setItem('milk2048_state', JSON.stringify({grid,tiles,nextId,score,best,moves,seconds,mode})); localStorage.setItem('milk2048_best', String(best)); }catch(e){console.warn(e);} }
  function loadState(){ try{ const raw=localStorage.getItem('milk2048_state'); if(!raw) return false; const d=JSON.parse(raw); if(!d) return false; grid=d.grid||emptyGrid(); tiles=d.tiles||{}; nextId=d.nextId||1; score=d.score||0; best=d.best||best; moves=d.moves||0; seconds=d.seconds||0; mode=d.mode||'classic'; return true; }catch(e){return false;} }
  function createTile(value,r,c,specialType=null){ const id='t'+(nextId++); const t={id,value,r,c,specialType,frozen:false}; tiles[id]=t; grid[r][c]=id; return t; }
  function addRandom(){ const empties=[]; for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) if(!grid[r][c]) empties.push({r,c}); if(!empties.length) return false; const pos = empties[Math.floor(Math.random()*empties.length)]; let v = Math.random()<0.9?2:4; if(mode==='chaos'){ const r=Math.random(); if(r<0.05){ const types=['bomb','multiplier','freeze','wildcard','shuffle']; const t=types[Math.floor(Math.random()*types.length)]; createTile(0,pos.r,pos.c,t); return true; } if(r<0.12) v = Math.random()<0.5?4:8; } createTile(v,pos.r,pos.c); return true; }
  function computeSizes(){ const rect = boardEl.getBoundingClientRect(); const gap = parseFloat(getComputedStyle(boardEl).getPropertyValue('gap')||16); const padding = parseFloat(getComputedStyle(boardEl).getPropertyValue('padding')||14); const totalGap = gap*(SIZE-1); const cell = (Math.min(rect.width, rect.height)-padding*2-totalGap)/SIZE; return {cell,gap,padding}; }
  function render(){ boardEl.innerHTML=''; for(let i=0;i<SIZE*SIZE;i++){ const cell = document.createElement('div'); cell.className='cell'; boardEl.appendChild(cell); } const sizes = computeSizes(); const cellSize = sizes.cell, gap=sizes.gap, padding=sizes.padding; Object.values(tiles).forEach(t=>{ if(!t) return; if(t.value<=0 && !t.specialType) return; let el = document.querySelector('[data-id="'+t.id+'"]'); const existed = !!el; if(!el){ el = document.createElement('div'); el.dataset.id = t.id; boardEl.appendChild(el); } if(t.specialType) el.className = 'tile chaos-'+t.specialType; else el.className = 'tile v'+t.value; if(t.value===1024) el.classList.add('v1024'); else el.classList.remove('v1024'); if(t.value>=2048) el.classList.add('v2048'); else el.classList.remove('v2048'); if(t.value>=4096) el.classList.add('legendary'); else el.classList.remove('legendary'); if(t.frozen) el.classList.add('frozen'); else el.classList.remove('frozen'); el.textContent = t.specialType? '': (t.value>0? t.value : ''); const x = padding + (cellSize+gap)*t.c; const y = padding + (cellSize+gap)*t.r; el.style.setProperty('--tile-x', x+'px'); el.style.setProperty('--tile-y', y+'px'); el.style.width = cellSize+'px'; el.style.height = cellSize+'px'; el.style.transform = 'translate('+x+'px,'+y+'px)'; if(!existed){ el.classList.add('new'); setTimeout(()=>el.classList.remove('new'), 420); } }); scoreEl.textContent = score; bestEl.textContent = best; movesEl.textContent = moves; timeEl.textContent = formatTime(seconds); }
  function canMove(){ for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++) if(!grid[r][c]) return true; for(let r=0;r<SIZE;r++) for(let c=0;c<SIZE;c++){ const id = grid[r][c]; if(!id) continue; const t = tiles[id]; if(!t || t.specialType) continue; const v = t.value; const dirs = [[1,0],[0,1]]; for(const d of dirs){ const rr=r+d[0], cc=c+d[1]; if(rr<0||rr>=SIZE||cc<0||cc>=SIZE) continue; const id2 = grid[rr][cc]; if(!id2) continue; const t2 = tiles[id2]; if(!t2 || t2.specialType) continue; if(t2.value===v) return true; } } return false; }
  
  // ИСПРАВЛЕННАЯ ФУНКЦИЯ ДВИЖЕНИЯ
  function moveLeft(){ 
    let moved=false; 
    for(let r=0;r<SIZE;r++){ 
      const row=[]; 
      for(let c=0;c<SIZE;c++){ 
        const id=grid[r][c]; 
        row.push(id?tiles[id]:null); 
      } 
      const compact = row.filter(x=>x && (x.value>0 || x.specialType)); 
      const processed = []; 
      for(let i=0;i<compact.length;i++){ 
        if(i+1<compact.length && !compact[i].specialType && !compact[i+1].specialType && compact[i].value>0 && compact[i].value===compact[i+1].value){ 
          compact[i].value *= 2; 
          score += compact[i].value; 
          if(score>best){ 
            best = score; 
            localStorage.setItem('milk2048_best', String(best)); 
          } 
          delete tiles[compact[i+1].id]; 
          try{ 
            mergeSound.currentTime=0; 
            mergeSound.play(); 
          }catch(e){} 
          processed.push(compact[i]); 
          i++; 
        } else { 
          processed.push(compact[i]); 
        } 
      } 
      while(processed.length<SIZE) processed.push(null); 
      for(let c=0;c<SIZE;c++){ 
        const item = processed[c]; 
        const prev = grid[r][c]; 
        if(item){ 
          grid[r][c]=item.id; 
          item.r=r; 
          item.c=c; 
        } else { 
          grid[r][c]=0; 
        } 
        if(prev !== grid[r][c]) moved = true; 
      } 
    } 
    return moved; 
  }

  function moveUp(){
    let moved = false;
    for(let c=0;c<SIZE;c++){
      const column = [];
      for(let r=0;r<SIZE;r++){
        const id = grid[r][c];
        column.push(id ? tiles[id] : null);
      }
      const compact = column.filter(x => x && (x.value > 0 || x.specialType));
      const processed = [];
      for(let i=0;i<compact.length;i++){
        if(i+1<compact.length && !compact[i].specialType && !compact[i+1].specialType && compact[i].value>0 && compact[i].value===compact[i+1].value){
          compact[i].value *= 2;
          score += compact[i].value;
          if(score>best){
            best = score;
            localStorage.setItem('milk2048_best', String(best));
          }
          delete tiles[compact[i+1].id];
          try{
            mergeSound.currentTime=0;
            mergeSound.play();
          }catch(e){}
          processed.push(compact[i]);
          i++;
        } else {
          processed.push(compact[i]);
        }
      }
      while(processed.length<SIZE) processed.push(null);
      for(let r=0;r<SIZE;r++){
        const item = processed[r];
        const prev = grid[r][c];
        if(item){
          grid[r][c] = item.id;
          item.r = r;
          item.c = c;
        } else {
          grid[r][c] = 0;
        }
        if(prev !== grid[r][c]) moved = true;
      }
    }
    return moved;
  }

  function moveRight(){
    let moved = false;
    for(let r=0;r<SIZE;r++){
      const row = [];
      for(let c=SIZE-1;c>=0;c--){
        const id = grid[r][c];
        row.push(id ? tiles[id] : null);
      }
      const compact = row.filter(x => x && (x.value > 0 || x.specialType));
      const processed = [];
      for(let i=0;i<compact.length;i++){
        if(i+1<compact.length && !compact[i].specialType && !compact[i+1].specialType && compact[i].value>0 && compact[i].value===compact[i+1].value){
          compact[i].value *= 2;
          score += compact[i].value;
          if(score>best){
            best = score;
            localStorage.setItem('milk2048_best', String(best));
          }
          delete tiles[compact[i+1].id];
          try{
            mergeSound.currentTime=0;
            mergeSound.play();
          }catch(e){}
          processed.push(compact[i]);
          i++;
        } else {
          processed.push(compact[i]);
        }
      }
      while(processed.length<SIZE) processed.push(null);
      for(let c=0;c<SIZE;c++){
        const item = processed[c];
        const actualCol = SIZE-1-c;
        const prev = grid[r][actualCol];
        if(item){
          grid[r][actualCol] = item.id;
          item.r = r;
          item.c = actualCol;
        } else {
          grid[r][actualCol] = 0;
        }
        if(prev !== grid[r][actualCol]) moved = true;
      }
    }
    return moved;
  }

  function moveDown(){
    let moved = false;
    for(let c=0;c<SIZE;c++){
      const column = [];
      for(let r=SIZE-1;r>=0;r--){
        const id = grid[r][c];
        column.push(id ? tiles[id] : null);
      }
      const compact = column.filter(x => x && (x.value > 0 || x.specialType));
      const processed = [];
      for(let i=0;i<compact.length;i++){
        if(i+1<compact.length && !compact[i].specialType && !compact[i+1].specialType && compact[i].value>0 && compact[i].value===compact[i+1].value){
          compact[i].value *= 2;
          score += compact[i].value;
          if(score>best){
            best = score;
            localStorage.setItem('milk2048_best', String(best));
          }
          delete tiles[compact[i+1].id];
          try{
            mergeSound.currentTime=0;
            mergeSound.play();
          }catch(e){}
          processed.push(compact[i]);
          i++;
        } else {
          processed.push(compact[i]);
        }
      }
      while(processed.length<SIZE) processed.push(null);
      for(let r=0;r<SIZE;r++){
        const item = processed[r];
        const actualRow = SIZE-1-r;
        const prev = grid[actualRow][c];
        if(item){
          grid[actualRow][c] = item.id;
          item.r = actualRow;
          item.c = c;
        } else {
          grid[actualRow][c] = 0;
        }
        if(prev !== grid[actualRow][c]) moved = true;
      }
    }
    return moved;
  }

  function doMove(dir){ 
    let moved = false; 
    if(dir === 'up'){ 
      moved = moveUp(); 
    } else if(dir === 'right'){ 
      moved = moveRight(); 
    } else if(dir === 'down'){ 
      moved = moveDown(); 
    } else if(dir === 'left'){ 
      moved = moveLeft(); 
    } 
    
    if(moved) {
      moves++;
      setTimeout(()=>{ 
        addRandom(); 
        render(); 
        saveState(); 
        if(!canMove()){ 
          showGameOver(); 
        } 
        if(checkWin()){ 
          showWin(); 
        } 
      }, 90); 
    }
    return moved; 
  }
  
  function postMove(){ moves++; setTimeout(()=>{ addRandom(); render(); saveState(); if(!canMove()){ showGameOver(); } if(checkWin()){ showWin(); } }, 90); }
  function checkWin(){ return Object.values(tiles).some(t=>t && !t.specialType && t.value>=2048); }
  function showWin(){ 
    // Найти плитку 2048 и создать взрыв
    Object.values(tiles).forEach(tile => {
      if(tile && tile.value >= 2048){
        const tileEl = document.querySelector(`[data-id="${tile.id}"]`);
        if(tileEl){
          const rect = tileEl.getBoundingClientRect();
          const centerX = rect.left + rect.width/2;
          const centerY = rect.top + rect.height/2;
          // Добавить анимацию взрыва к плитке
          tileEl.style.animation = 'explosion 1.5s ease-out forwards';
          // Создать взрыв через 0.5 секунды
          setTimeout(() => createExplosion(centerX, centerY), 500);
        }
      }
    });
    
    // Показать экран победы через 2 секунды
    setTimeout(() => {
      document.getElementById('victory-score').textContent = score;
      document.getElementById('victory-moves').textContent = moves;
      document.getElementById('victory-time').textContent = formatTime(seconds);
      document.getElementById('victory-modal').style.display='flex';
      launchConfetti();
      saveHistory();
    }, 2000);
  }
  function showGameOver(){ document.getElementById('final-score').textContent = score; document.getElementById('modal-over').style.display='block'; document.getElementById('modal-over').setAttribute('aria-hidden','false'); saveHistory(); }
  function saveHistory(){ try{ const hist = JSON.parse(localStorage.getItem('milk2048_history')||'[]'); hist.push({date:new Date().toLocaleString(), score, moves, time: formatTime(seconds), mode}); localStorage.setItem('milk2048_history', JSON.stringify(hist)); populateResults(); }catch(e){} }
  function populateResults(){ if(!resultsList) return; resultsList.innerHTML=''; const arr = JSON.parse(localStorage.getItem('milk2048_history')||'[]').slice().reverse(); let idx=0; for(const it of arr){ if(it.score<1000) continue; idx++; const li=document.createElement('li'); li.className='results-list-item'; const rank=document.createElement('div'); rank.className='rank'; rank.textContent = idx; const info=document.createElement('div'); info.className='info'; info.innerHTML = '<div style="font-weight:800">'+it.score+' pts</div><div style="font-size:12px;color:#45636c">'+it.date+' • '+it.mode+' • '+it.time+'</div>'; li.appendChild(rank); li.appendChild(info); if(idx===1) li.classList.add('gold-card'); else if(idx===2) li.classList.add('silver-card'); else if(idx===3) li.classList.add('bronze-card'); resultsList.appendChild(li); } }
  document.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft') doMove('left'); if(e.key==='ArrowRight') doMove('right'); if(e.key==='ArrowUp') doMove('up'); if(e.key==='ArrowDown') doMove('down'); if(e.key.toLowerCase()==='u'){ Object.values(tiles).forEach(t=>{ if(t && t.value>0 && !t.specialType) t.value*=4; }); render(); saveState(); populateResults(); } });
  (function(){ let sx=0, sy=0, st=0; boardEl.addEventListener('touchstart', e=>{ const t = e.changedTouches[0]; sx=t.clientX; sy=t.clientY; st=Date.now(); }, {passive:true}); boardEl.addEventListener('touchend', e=>{ const t = e.changedTouches[0]; const dx = t.clientX - sx; const dy = t.clientY - sy; const dt = Date.now() - st; if(dt<700){ if(Math.abs(dx)>Math.abs(dy) && Math.abs(dx)>30){ if(dx>0) doMove('right'); else doMove('left'); } else if(Math.abs(dy)>30){ if(dy>0) doMove('down'); else doMove('up'); } } }, {passive:true}); })();
  function playSwishSound(){ try{ swishSound.currentTime=0; swishSound.play(); }catch(e){} }
  function updateBalance(){ document.getElementById('fake-balance').textContent = fakeBalance; localStorage.setItem('milk2048_balance', String(fakeBalance)); }
  function addMoney(amount){ fakeBalance += amount; updateBalance(); }
  function purchaseBackground(bgKey){ if(purchasedBackgrounds.includes(bgKey)) return true; if(fakeBalance >= 49){ fakeBalance -= 49; purchasedBackgrounds.push(bgKey); localStorage.setItem('milk2048_purchased', JSON.stringify(purchasedBackgrounds)); updateBalance(); return true; } return false; }
  function isPurchased(bgKey){ return purchasedBackgrounds.includes(bgKey); }
  
  function simulatePayment(bgKey, bgTitle){ 
    const modal = document.createElement('div');
    modal.style.cssText = `
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(0,0,0,0.8); z-index: 1000; display: flex; 
      align-items: center; justify-content: center; font-family: inherit;
    `;
    
    const paymentBox = document.createElement('div');
    paymentBox.style.cssText = `
      background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
      border: 2px solid #FFD700; border-radius: 20px; padding: 30px;
      max-width: 400px; width: 90%; text-align: center; color: #fff;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 30px rgba(255,215,0,0.3);
    `;
    
    paymentBox.innerHTML = `
      <h3 style="margin: 0 0 20px 0; color: #FFD700; font-size: 24px;">💳 Покупка темы</h3>
      <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; margin: 20px 0;">
        <div style="font-size: 18px; margin-bottom: 10px;">${bgTitle}</div>
        <div style="font-size: 32px; color: #FFD700; font-weight: 700;">49 ₽</div>
      </div>
      <div style="margin: 20px 0; font-size: 14px; color: #aaa;">
        После покупки тема будет применена автоматически
      </div>
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button onclick="closePaymentModal();" style="flex: 1; background: #666; color: #fff; border: none; padding: 12px; border-radius: 8px; cursor: pointer;">Отмена</button>
        <button onclick="processPayment('${bgKey}', '${bgTitle}');" style="flex: 1; background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 700;">Купить</button>
      </div>
    `;
    
    modal.appendChild(paymentBox);
    document.body.appendChild(modal);
    
    window.closePaymentModal = () => { document.body.removeChild(modal); };
    window.processPayment = (key, title) => {
      if(fakeBalance >= 49) {
        // Успешная покупка
        fakeBalance -= 49;
        purchasedBackgrounds.push(key);
        localStorage.setItem('milk2048_purchased', JSON.stringify(purchasedBackgrounds));
        updateBalance();
        
        // Применяем тему
        applyTheme(key);
        
        // Показываем уведомление
        showSuccessNotification(`✅ Тема "${title}" куплена и применена!`);
        
        document.body.removeChild(modal);
        populateShop();
      } else {
        // Недостаточно средств
        showErrorNotification('❌ Недостаточно средств! Нажмите +100₽ чтобы добавить деньги.');
      }
    };
  }
  
  function showSuccessNotification(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed; top: 20px; right: 20px; z-index: 3000;
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white; padding: 16px 24px; border-radius: 12px;
      font-weight: 700; box-shadow: 0 8px 32px rgba(76,175,80,0.4);
      animation: slideInRight 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 3000);
  }
  
  function showErrorNotification(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed; top: 20px; right: 20px; z-index: 3000;
      background: linear-gradient(135deg, #f44336, #d32f2f);
      color: white; padding: 16px 24px; border-radius: 12px;
      font-weight: 700; box-shadow: 0 8px 32px rgba(244,67,54,0.4);
      animation: slideInRight 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 3000);
  }
  
  function createExplosion(x, y){ const explosion = document.createElement('div'); explosion.style.position='fixed'; explosion.style.left=x+'px'; explosion.style.top=y+'px'; explosion.style.width='100px'; explosion.style.height='100px'; explosion.style.pointerEvents='none'; explosion.style.zIndex=9998; explosion.style.transform='translate(-50%, -50%)'; document.body.appendChild(explosion); for(let i=0;i<20;i++){ const particle = document.createElement('div'); particle.className='explosion-particle'; const angle = (i/20)*Math.PI*2; const distance = 50 + Math.random()*50; particle.style.left = (50 + Math.cos(angle)*distance) + 'px'; particle.style.top = (50 + Math.sin(angle)*distance) + 'px'; particle.style.animationDelay = Math.random()*0.5 + 's'; explosion.appendChild(particle); } setTimeout(()=> explosion.remove(), 1500); }
  function createFireworks(){ for(let i=0;i<15;i++){ setTimeout(()=>{ const firework = document.createElement('div'); firework.className='firework'; firework.style.left = Math.random()*100+'%'; firework.style.top = '100vh'; firework.style.zIndex = 9999; document.body.appendChild(firework); setTimeout(()=> firework.remove(), 3000); }, i*200); } }
  function launchMegaConfetti(){ const conf = document.createElement('div'); conf.style.position='fixed'; conf.style.left=0; conf.style.top=0; conf.style.width='100%'; conf.style.height='100%'; conf.style.pointerEvents='none'; conf.style.zIndex=9999; document.body.appendChild(conf); const emojis=['🎉','✨','💫','🌟','🥳','🎊','🎈','🏆','👑','💎','⭐','🔥']; for(let i=0;i<80;i++){ const s=document.createElement('div'); s.textContent=emojis[Math.floor(Math.random()*emojis.length)]; s.style.position='absolute'; s.style.left = Math.random()*100+'%'; s.style.top = '-10%'; s.style.fontSize = (15+Math.random()*40)+'px'; s.style.transition = 'all 3s cubic-bezier(0.25,0.46,0.45,0.94)'; s.style.animation = 'float 2s ease-in-out infinite'; conf.appendChild(s); setTimeout(()=>{ s.style.top = (120+Math.random()*30)+'%'; s.style.transform = 'rotate('+ (Math.random()*1080-540) +'deg) scale('+ (0.5+Math.random()*1.5) +')'; s.style.opacity = 0; }, 50 + i*30); } setTimeout(()=> conf.remove(), 4000); }
  function launchConfetti(){ launchMegaConfetti(); createFireworks(); }
  document.getElementById('new-game-btn')?.addEventListener('click', ()=>{ resetState(); addRandom(); addRandom(); render(); saveState(); startTimer(); });
  document.getElementById('mode-classic')?.addEventListener('click', ()=>{ mode='classic'; document.getElementById('mode-classic').classList.add('active'); document.getElementById('mode-chaos').classList.remove('active'); chaosTips.style.display='none'; saveState(); });
  document.getElementById('mode-chaos')?.addEventListener('click', ()=>{ mode='chaos'; document.getElementById('mode-chaos').classList.add('active'); document.getElementById('mode-classic').classList.remove('active'); chaosTips.style.display='block'; saveState(); });
  document.getElementById('close-results')?.addEventListener('click', ()=>{ document.getElementById('results-panel').style.display='none'; document.querySelectorAll('#bottom-nav .nav-btn').forEach(b=>b.classList.remove('active')); document.querySelector('#bottom-nav .nav-btn[data-target="game-app"]').classList.add('active'); });
  document.getElementById('results-panel')?.addEventListener('click', (e)=>{ if(e.target === document.getElementById('results-panel')){ document.getElementById('results-panel').style.display='none'; document.querySelectorAll('#bottom-nav .nav-btn').forEach(b=>b.classList.remove('active')); document.querySelector('#bottom-nav .nav-btn[data-target="game-app"]').classList.add('active'); } });
  document.getElementById('close-win')?.addEventListener('click', ()=>{ document.getElementById('modal-win').style.display='none'; });
  document.getElementById('victory-continue')?.addEventListener('click', ()=>{ document.getElementById('victory-modal').style.display='none'; });
  document.getElementById('victory-restart')?.addEventListener('click', ()=>{ document.getElementById('victory-modal').style.display='none'; resetState(); addRandom(); addRandom(); render(); saveState(); startTimer(); });
  document.getElementById('continue-btn')?.addEventListener('click', ()=>{ document.getElementById('modal-win').style.display='none'; });
  document.getElementById('restart-btn')?.addEventListener('click', ()=>{ document.getElementById('modal-over').style.display='none'; resetState(); addRandom(); addRandom(); render(); saveState(); startTimer(); });
  document.getElementById('close-over')?.addEventListener('click', ()=>{ document.getElementById('modal-over').style.display='none'; });
  document.querySelectorAll('#bottom-nav .nav-btn').forEach(btn=>{ btn.addEventListener('click', ()=>{ playSwishSound(); document.querySelectorAll('#bottom-nav .nav-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); document.getElementById('shop-panel').style.display='none'; document.getElementById('results-panel').style.display='none'; const target = btn.getAttribute('data-target'); if(target==='game-app'){ document.getElementById('game-app').style.display='block'; } else { document.getElementById('game-app').style.display='block'; document.getElementById(target).style.display='block'; } }); });
  
  function populateShop(){ 
    shopItems.innerHTML=''; 
    const choices=[
      {key:'default',title:'Стандарт',rarity:'common',icon:'🌟',preview:'linear-gradient(135deg, #dceffb 0%, #f7d7ff 60%)'},
      {key:'ocean',title:'Океан',rarity:'rare',icon:'🌊',preview:'linear-gradient(135deg,#b3e5fc 0%,#4fc3f7 70%)'},
      {key:'coral',title:'Кораллы',rarity:'epic',icon:'🪸',preview:'linear-gradient(135deg,#ffe6d6 0%,#ffd6c5 70%)'},
      {key:'forest',title:'Лес',rarity:'rare',icon:'🌲',preview:'linear-gradient(135deg,#c8e6c9 0%,#81c784 70%)'},
      {key:'space',title:'Космос',rarity:'legendary',icon:'🌌',preview:'linear-gradient(135deg,#1a1a2e 0%,#0f1419 70%)'},
      {key:'meadow',title:'Луговой',rarity:'epic',icon:'🌼',preview:'linear-gradient(135deg,#fff8dc 0%,#f0e68c 70%)'}
    ]; 
    
    choices.forEach((it, index)=>{
      const card = document.createElement('div');
      card.className = 'shop-card clash-style';
      
      // Rarity-based styling
      let rarityClass = 'common';
      let glowColor = '#9CA3AF';
      let borderColor = '#6B7280';
      
      switch(it.rarity) {
        case 'rare': 
          rarityClass = 'rare'; 
          glowColor = '#3B82F6'; 
          borderColor = '#1D4ED8';
          break;
        case 'epic': 
          rarityClass = 'epic'; 
          glowColor = '#8B5CF6'; 
          borderColor = '#7C3AED';
          break;
        case 'legendary': 
          rarityClass = 'legendary'; 
          glowColor = '#F59E0B'; 
          borderColor = '#D97706';
          break;
      }
      
      const isOwned = isPurchased(it.key);
      const isActive = currentTheme === it.key;
      
      card.style.cssText = `
        width: 100%;
        height: 180px;
        background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
        border: 3px solid ${isActive ? '#4CAF50' : borderColor};
        border-radius: 16px;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 20px ${isActive ? '#4CAF50' : glowColor}40;
        transform: translateY(0);
        animation: slideInUp 0.6s ease-out ${index * 0.1}s both;
      `;
      
      // Active indicator
      if(isActive) {
        const activeIndicator = document.createElement('div');
        activeIndicator.style.cssText = `
          position: absolute; top: 8px; left: 8px; z-index: 10;
          background: linear-gradient(135deg, #4CAF50, #45a049);
          color: white; padding: 4px 8px; border-radius: 12px;
          font-size: 10px; font-weight: 700;
        `;
        activeIndicator.textContent = '✓ АКТИВНА';
        card.appendChild(activeIndicator);
      }
      
      // Glow effect
      const glow = document.createElement('div');
      glow.style.cssText = `
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, ${isActive ? '#4CAF50' : glowColor}, transparent, ${isActive ? '#4CAF50' : glowColor});
        border-radius: 18px;
        opacity: 0.6;
        z-index: -1;
        filter: blur(8px);
      `;
      card.appendChild(glow);
      
      // Preview area
      const preview = document.createElement('div');
      preview.style.cssText = `
        width: 100%;
        height: 100px;
        background: ${it.preview};
        border-radius: 12px 12px 0 0;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        text-shadow: 0 2px 8px rgba(0,0,0,0.3);
      `;
      preview.textContent = it.icon;
      card.appendChild(preview);
      
      // Title area
      const titleArea = document.createElement('div');
      titleArea.style.cssText = `
        padding: 8px;
        background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.2) 100%);
        height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
      `;
      
      const title = document.createElement('div');
      title.style.cssText = `
        color: #fff;
        font-size: 14px;
        font-weight: 700;
        text-align: center;
        margin-bottom: 4px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      `;
      title.textContent = it.title;
      
      const rarity = document.createElement('div');
      rarity.style.cssText = `
        color: ${glowColor};
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      `;
      rarity.textContent = it.rarity.toUpperCase();
      
      const price = document.createElement('div');
      price.style.cssText = `
        position: absolute;
        top: 8px;
        right: 8px;
        background: ${isOwned ? 'linear-gradient(135deg, #4CAF50, #45a049)' : 'linear-gradient(135deg, #FFD700, #FFA500)'};
        color: ${isOwned ? '#fff' : '#000'};
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 700;
        box-shadow: 0 2px 8px rgba(255,215,0,0.3);
      `;
      price.textContent = isOwned ? '✓ КУПЛЕНА' : '49 ₽';
      
      titleArea.appendChild(title);
      titleArea.appendChild(rarity);
      titleArea.appendChild(price);
      card.appendChild(titleArea);
      
      // Hover effects
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-8px) scale(1.02)';
        card.style.boxShadow = `0 16px 48px rgba(0,0,0,0.4), 0 0 30px ${isActive ? '#4CAF50' : glowColor}60`;
        glow.style.opacity = '1';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0) scale(1)';
        card.style.boxShadow = `0 8px 32px rgba(0,0,0,0.3), 0 0 20px ${isActive ? '#4CAF50' : glowColor}40`;
        glow.style.opacity = '0.6';
      });
      
      // Click handler
      card.addEventListener('click', () => {
        playSwishSound();
        const isOwned = isPurchased(it.key);
        
        if(isOwned) {
          // Применяем тему если она куплена
          applyTheme(it.key);
          showSuccessNotification(`✅ Тема "${it.title}" применена!`);
          populateShop(); // Обновляем магазин чтобы показать активную тему
        } else {
          // Показываем окно покупки
          simulatePayment(it.key, it.title);
        }
        
        // Visual feedback
        card.style.transform = 'scale(0.95)';
        setTimeout(() => {
          card.style.transform = 'translateY(-8px) scale(1.02)';
        }, 100);
      });
      
      shopItems.appendChild(card);
    });
  }
  
  // Add CSS for notifications
  const notificationCSS = document.createElement('style');
  notificationCSS.textContent = `
    @keyframes slideInRight {
      0% { transform: translateX(100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }
  `;
  document.head.appendChild(notificationCSS);
  
  document.getElementById('tutorial-start')?.addEventListener('click', ()=>{ 
    playSwishSound();
    document.getElementById('tutorial-modal').style.display='none'; 
    document.getElementById('game-app').style.display='block'; 
    launchConfetti();
  });
  document.getElementById('tutorial-shop')?.addEventListener('click', ()=>{ 
    playSwishSound();
    document.getElementById('tutorial-modal').style.display='none'; 
    document.getElementById('shop-panel').style.display='block'; 
    document.querySelectorAll('#bottom-nav .nav-btn').forEach(b=>b.classList.remove('active')); 
    document.querySelector('#bottom-nav .nav-btn[data-target="shop-panel"]').classList.add('active'); 
  });
  
  document.getElementById('tutorial-skip')?.addEventListener('click', ()=>{ 
    playSwishSound();
    document.getElementById('tutorial-modal').style.display='none';
    document.getElementById('game-app').style.display='block';
  });
  
  // Закрытие обучения кликом вне окна
  document.getElementById('tutorial-modal')?.addEventListener('click', (e)=>{
    if(e.target === document.getElementById('tutorial-modal')){
      playSwishSound();
      document.getElementById('tutorial-modal').style.display='none';
      document.getElementById('game-app').style.display='block';
    }
  });
  
  // Initialize
  const loaded = loadState(); 
  if(!loaded){ resetState(); addRandom(); addRandom(); } 
  updateBalance(); 
  populateShop(); 
  render(); 
  populateResults(); 
  startTimer(); 
  setInterval(saveState, 5000); 
  
  // Apply saved theme
  applyTheme(currentTheme);
  
  window.milk2048 = { resetState, render, addMoney, applyTheme };
})();
</script>
</body>
</html>

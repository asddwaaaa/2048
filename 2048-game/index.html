<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>2048</title>
<style>
:root {
  /* –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ 2048 */
  --bg-primary: #faf8ef;
  --bg-secondary: #bbada0;
  --tile-2: #eee4da;
  --tile-4: #ede0c8;
  --tile-8: #f2b179;
  --tile-16: #f59563;
  --tile-32: #f67c5f;
  --tile-64: #f65e3b;
  --tile-128: #edcf72;
  --tile-256: #edcc61;
  --tile-512: #edc850;
  --tile-1024: #edc53f;
  --tile-2048: #edc22e;
  --text-dark: #776e65;
  --text-light: #f9f6f2;
  --accent-new: #ff6f61;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  user-select: none;
  -webkit-user-select: none;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
  background: var(--bg-primary);
  color: var(--text-dark);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  touch-action: none;
  overflow: hidden;
  overscroll-behavior: none;
}

.container {
  width: 100%;
  max-width: 500px;
  padding: 20px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

h1 {
  font-size: 80px;
  font-weight: bold;
  line-height: 1;
  margin: 0;
}

.scores-container {
  display: flex;
  gap: 10px;
}

.score-box {
  background: var(--bg-secondary);
  padding: 15px 25px;
  border-radius: 3px;
  color: white;
  text-align: center;
  position: relative;
}

.score-label {
  font-size: 13px;
  text-transform: uppercase;
  opacity: 0.9;
}

.score-value {
  font-size: 25px;
  font-weight: bold;
  display: block;
}

.new-game-btn {
  background: var(--accent-new);
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 3px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 15px;
}

.new-game-btn:active {
  transform: scale(0.95);
}

.board-container {
  background: var(--bg-secondary);
  padding: 15px;
  border-radius: 6px;
  width: 100%;
  max-width: 440px;
  margin: 0 auto;
  position: relative;
}

.board {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 15px;
  width: 100%;
  aspect-ratio: 1;
  position: relative;
}

/* –ü–ª–∏—Ç–∫–∏ */
.tile {
  position: absolute;
  width: calc(25% - 11.25px);
  height: calc(25% - 11.25px);
  margin: 7.5px;
  background: var(--tile-bg);
  border-radius: 3px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 45px;
  font-weight: bold;
  color: var(--text-dark);
  transition: all 0.15s ease-in-out;
  z-index: 2;
  box-shadow: 0 0 30px 10px rgba(243, 215, 116, 0);
}

.tile.v2 { background: var(--tile-2); }
.tile.v4 { background: var(--tile-4); }
.tile.v8 { background: var(--tile-8); color: var(--text-light); }
.tile.v16 { background: var(--tile-16); color: var(--text-light); }
.tile.v32 { background: var(--tile-32); color: var(--text-light); }
.tile.v64 { background: var(--tile-64); color: var(--text-light); }
.tile.v128 { background: var(--tile-128); color: var(--text-light); font-size: 40px; }
.tile.v256 { background: var(--tile-256); color: var(--text-light); font-size: 40px; }
.tile.v512 { background: var(--tile-512); color: var(--text-light); font-size: 40px; }
.tile.v1024 { background: var(--tile-1024); color: var(--text-light); font-size: 35px; }
.tile.v2048 { background: var(--tile-2048); color: var(--text-light); font-size: 35px; }

.tile.new {
  animation: appear 0.2s ease;
}

.tile.merged {
  animation: pop 0.2s ease;
  z-index: 3;
}

@keyframes appear {
  0% { opacity: 0; transform: scale(0); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes pop {
  0% { transform: scale(0.8); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(255,255,255,0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.overlay.active {
  display: flex;
}

.modal {
  background: var(--bg-secondary);
  padding: 40px;
  border-radius: 6px;
  text-align: center;
  box-shadow: 0 0 30px rgba(0,0,0,0.2);
}

.modal h2 {
  font-size: 48px;
  margin-bottom: 20px;
  color: white;
}

.modal button {
  background: var(--accent-new);
  color: white;
  border: none;
  padding: 12px 30px;
  border-radius: 3px;
  font-size: 20px;
  font-weight: bold;
  margin-top: 20px;
  cursor: pointer;
}

/* –Ø—á–µ–π–∫–∏ —Ñ–æ–Ω–∞ */
.cell-bg {
  background: rgba(238, 228, 218, 0.35);
  border-radius: 3px;
}

/* –ú–æ–±–∏–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ */
@media (max-width: 480px) {
  h1 { font-size: 50px; }
  .tile { font-size: 35px; }
  .tile.v128, .tile.v256, .tile.v512 { font-size: 30px; }
  .tile.v1024, .tile.v2048 { font-size: 25px; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>2048</h1>
    <div class="scores-container">
      <div class="score-box">
        <div class="score-label">–°—á—ë—Ç</div>
        <div class="score-value" id="score">0</div>
      </div>
      <div class="score-box">
        <div class="score-label">–õ—É—á—à–∏–π</div>
        <div class="score-value" id="best">0</div>
      </div>
    </div>
  </div>
  <button class="new-game-btn" id="new-game">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
  
  <div class="board-container">
    <div class="board" id="board">
      <!-- –§–æ–Ω–æ–≤—ã–µ —è—á–µ–π–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
    </div>
  </div>
</div>

<div class="overlay" id="game-over">
  <div class="modal">
    <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
    <p>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: <span id="final-score">0</span></p>
    <button id="restart">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  </div>
</div>

<div class="overlay" id="victory">
  <div class="modal">
    <h2>üéâ –ü–æ–±–µ–¥–∞! üéâ</h2>
    <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ 2048!</p>
    <p>–°—á—ë—Ç: <span id="victory-score">0</span></p>
    <button id="continue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>
</div>

<script>
const BOARD_SIZE = 4;
const board = document.getElementById('board');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const newGameBtn = document.getElementById('new-game');
const gameOverOverlay = document.getElementById('game-over');
const victoryOverlay = document.getElementById('victory');
const finalScoreEl = document.getElementById('final-score');
const victoryScoreEl = document.getElementById('victory-score');

let grid = [];
let score = 0;
let best = parseInt(localStorage.getItem('bestScore') || '0', 10);
let hasWon = false;

bestEl.textContent = best;

// –°–æ–∑–¥–∞—ë–º —Ñ–æ–Ω–æ–≤—ã–µ —è—á–µ–π–∫–∏
function createCells() {
  board.innerHTML = '';
  for (let i = 0; i < BOARD_SIZE * BOARD_SIZE; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell-bg';
    board.appendChild(cell);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function initGrid() {
  grid = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(0));
}

function addTile() {
  const emptyCells = [];
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      if (grid[r][c] === 0) emptyCells.push([r, c]);
    }
  }
  
  if (emptyCells.length === 0) return false;
  
  const [row, col] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
  grid[row][col] = { value: Math.random() < 0.9 ? 2 : 4, id: Date.now() };
  return true;
}

function render() {
  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–ª–∏—Ç–∫–∏
  document.querySelectorAll('.tile').forEach(tile => tile.remove());
  
  // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      const cell = grid[r][c];
      if (cell !== 0) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.textContent = cell.value;
        tile.classList.add(`v${cell.value}`);
        tile.dataset.id = cell.id;
        tile.style.left = `${c * 25 + 7.5}px`;
        tile.style.top = `${r * 25 + 7.5}px`;
        board.appendChild(tile);
      }
    }
  }
}

function move(direction) {
  let moved = false;
  const originalGrid = JSON.stringify(grid);
  
  if (direction === 'left' || direction === 'right') {
    for (let r = 0; r < BOARD_SIZE; r++) {
      let row = grid[r].filter(val => val !== 0);
      if (direction === 'right') row.reverse();
      
      // –°–ª–∏—è–Ω–∏–µ
      for (let i = 0; i < row.length - 1; i++) {
        if (row[i].value === row[i + 1].value) {
          row[i].value *= 2;
          score += row[i].value;
          row.splice(i + 1, 1);
          moved = true;
        }
      }
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫
      while (row.length < BOARD_SIZE) row.push(0);
      if (direction === 'right') row.reverse();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º grid
      grid[r] = row.map((cell, index) => 
        cell !== 0 ? { value: cell.value, id: Date.now() + r * BOARD_SIZE + index } : 0
      );
    }
  } else {
    for (let c = 0; c < BOARD_SIZE; c++) {
      let column = grid.map(row => row[c]).filter(val => val !== 0);
      if (direction === 'down') column.reverse();
      
      // –°–ª–∏—è–Ω–∏–µ
      for (let i = 0; i < column.length - 1; i++) {
        if (column[i].value === column[i + 1].value) {
          column[i].value *= 2;
          score += column[i].value;
          column.splice(i + 1, 1);
          moved = true;
        }
      }
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫
      while (column.length < BOARD_SIZE) column.push(0);
      if (direction === 'down') column.reverse();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º grid
      column.forEach((cell, index) => {
        const r = index;
        if (cell !== 0) {
          grid[r][c] = { value: cell.value, id: Date.now() + r * BOARD_SIZE + c };
        } else {
          grid[r][c] = 0;
        }
      });
    }
  }
  
  return JSON.stringify(grid) !== originalGrid;
}

function canMove() {
  // –ü—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      if (grid[r][c] === 0) return true;
    }
  }
  
  // –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–∏—è–Ω–∏—è
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE - 1; c++) {
      if (grid[r][c] !== 0 && grid[r][c + 1] !== 0 && 
          grid[r][c].value === grid[r][c + 1].value) return true;
    }
  }
  
  for (let r = 0; r < BOARD_SIZE - 1; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      if (grid[r][c] !== 0 && grid[r + 1][c] !== 0 && 
          grid[r][c].value === grid[r + 1][c].value) return true;
    }
  }
  
  return false;
}

function checkWin() {
  for (let r = 0; r < BOARD_SIZE; r++) {
    for (let c = 0; c < BOARD_SIZE; c++) {
      if (grid[r][c] !== 0 && grid[r][c].value === 2048 && !hasWon) {
        hasWon = true;
        victoryScoreEl.textContent = score;
        victoryOverlay.classList.add('active');
        return true;
      }
    }
  }
  return false;
}

function handleMove(direction) {
  const moved = move(direction);
  
  if (moved) {
    addTile();
    setTimeout(() => {
      render();
      updateScore();
      
      if (checkWin()) {
        // –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
      } else if (!canMove()) {
        finalScoreEl.textContent = score;
        gameOverOverlay.classList.add('active');
        saveBestScore();
      }
    }, 50);
  }
}

function updateScore() {
  scoreEl.textContent = score;
  if (score > best) {
    best = score;
    bestEl.textContent = best;
    localStorage.setItem('bestScore', best);
  }
}

function saveBestScore() {
  if (score > best) {
    best = score;
    bestEl.textContent = best;
    localStorage.setItem('bestScore', best);
  }
}

function newGame() {
  score = 0;
  hasWon = false;
  updateScore();
  gameOverOverlay.classList.remove('active');
  victoryOverlay.classList.remove('active');
  initGrid();
  addTile();
  addTile();
  render();
}

// –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowUp') handleMove('up');
  if (e.key === 'ArrowDown') handleMove('down');
  if (e.key === 'ArrowLeft') handleMove('left');
  if (e.key === 'ArrowRight') handleMove('right');
});

// –°–µ–Ω—Å–æ—Ä
let touchStartX = 0;
let touchStartY = 0;

BOARD_CONTAINER.addEventListener('touchstart', (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
  e.preventDefault();
}, { passive: false });

document.addEventListener('touchend', (e) => {
  if (!e.changedTouches.length) return;
  const touchEndX = e.changedTouches[0].clientX;
  const touchEndY = e.changedTouches[0].clientY;
  
  const dx = touchEndX - touchStartX;
  const dy = touchEndY - touchStartY;
  
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 30) handleMove('right');
    else if (dx < -30) handleMove('left');
  } else {
    if (dy > 30) handleMove('down');
    else if (dy < -30) handleMove('up');
  }
}, { passive: true });

newGameBtn.addEventListener('click', newGame);
document.getElementById('restart').addEventListener('click', newGame);
document.getElementById('continue').addEventListener('click', () => {
  victoryOverlay.classList.remove('active');
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
createCells();
newGame();
</script>
</body>
</html>
